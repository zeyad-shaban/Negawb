{% extends 'categories/base.html' %}
{% block title %}Invite to {{group.title}} {% endblock title %}

{% block content %}
<script>
    $(document).ready(function () {

        $('.id_inviteForm').submit(function (event) {
            event.preventDefault()
        })

    })
</script>
<h1>Friends</h1>

{% for friend in friends %}
<li class="list-group-item">
    <div class="row w-100">
        <div class="col-12 col-sm-6 col-md-3 px-0">
            <a href="{% url 'people:people' friend.id %}">
                {% if friend.who_see_avatar == 'everyone' %}
                <img src="{{ friend.avatar.url }}" alt="{{ friend.username }}"
                    class="img-fluid rounded-circle d-block mx-auto" height="73" width="73">
                {% else %}
                <img src="/media/profile_images/DefaultUserImage.WebP" alt="{{ friend.username }}"
                    class="img-fluid rounded-circle d-block mx-auto" height="73" width="73">
                {% endif %}
            </a>
        </div>

        <div class="col-12 col-sm-6 col-md-9 text-center text-sm-left">
            <a href="{% url 'people:people' friend.id %}">
                <label class="name lead">{{ friend.username }}</label>
            </a>
            <br>

            {% if friend.phone %}
            <span class="fa fa-fw fa-phone fa-fw text-muted" data-toggle="tooltip" title="Phone Number"
                data-original-title="{{ friend.phone }}"></span>
            <span class="text-muted small">{{ friend.phone }}</span>
            <br>
            {% endif %}
            {% if friend.email and friend.show_email == True %}
            <span class="fa fa-fw fa-envelope fa-fw text-muted" data-toggle="tooltip" title="Email"
                data-original-title="{{ friend.email }}"></span>
            <span class="text-muted small text-truncate">{{ friend.email }}</span>
            <br>
            {% endif %}
            <span class="fa fa-fw fa-envelope fa-fw text-muted" data-toggle="tooltip" title="Bio"
                data-original-title="{{ friend.bio }}"></span>
            <span class="small text-truncate">{{ friend.bio }}</span>
            <form class="id_inviteForm" method="GET">
                {% csrf_token %}
                <input type="submit" value="Invite" name="invite," class="btn btn-primary float-right"
                    id="id_inviteButton{{friend.id}}">
            </form>
        </div>
    </div>
</li>
<!-- invite friend ajax script -->
<script>
    $(document).ready(function () {

        $('#id_inviteButton{{friend.id}}').click(function () {
            $.ajax({
                url: "{% url 'social:create_invite' friend.id group.id %}",
                data: {
                    'user_pk': "{{friend.id}}",
                    'group_pk': "{{ group.id }}",
                },
                success: function (data) {
                    {
                        $('#message_area').html('')
                        if (data.message.tags === 'error') {
                            $('#message_area').append(`
                            <div class="alert alert-danger fixed-top">${data.message.text}</div>
                            `)
                        } else {
                            $('#message_area').append(`
        <div class="alert alert-${data.message.tags} fixed-top">${data.message.text}</div>
                                `)
                        }
                    }
                }
            })
            setTimeout(() => {
                $('#message_area').fadeOut()
            }, 3200);
        })

    })
</script>
{% endfor %}
<hr>
<h1>All Users</h1>
{% for view_user in users %}
<li class="list-group-item">
    <div class="row w-100">
        <div class="col-12 col-sm-6 col-md-3 px-0">
            <a href="{% url 'people:people' view_user.id %}">
                {% if view_user.who_see_avatar == 'everyone' %}
                <img src="{{ view_user.avatar.url }}" alt="{{ view_user.username }}"
                    class="img-fluid rounded-circle d-block mx-auto" height="73" width="73">
                {% else %}
                <img src="/media/profile_images/DefaultUserImage.WebP" alt="{{ view_user.username }}"
                    class="img-fluid rounded-circle d-block mx-auto" height="73" width="73">
                {% endif %}
            </a>
        </div>

        <div class="col-12 col-sm-6 col-md-9 text-center text-sm-left">
            <a href="{% url 'people:people' view_user.id %}">
                <label class="name lead">{{ view_user.username }}</label>
            </a>
            <br>

            {% if view_user.phone %}
            <span class="fa fa-fw fa-phone fa-fw text-muted" data-toggle="tooltip" title="Phone Number"
                data-original-title="{{ view_user.phone }}"></span>
            <span class="text-muted small">{{ view_user.phone }}</span>
            <br>
            {% endif %}
            {% if view_user.email and view_user.show_email == True %}
            <span class="fa fa-fw fa-envelope fa-fw text-muted" data-toggle="tooltip" title="Email"
                data-original-title="{{ view_user.email }}"></span>
            <span class="text-muted small text-truncate">{{ view_user.email }}</span>
            <br>
            {% endif %}
            <span class="fa fa-fw fa-envelope fa-fw text-muted" data-toggle="tooltip" title="Bio"
                data-original-title="{{ view_user.bio }}"></span>
            <span class="small text-truncate">{{ view_user.bio }}</span>
            <form class="id_inviteForm" method="GET">
                {% csrf_token %}
                <input type="submit" value="Invite" name="invite" class="btn btn-primary float-right id_inviteButton"
                    id="id_inviteButton{{view_user.id}}">
            </form>
        </div>
    </div>
</li>
<!-- invite user script -->
<script>
    $(document).ready(function () {
        $('#id_inviteButton{{view_user.id}}').click(function () {
            $.ajax({
                url: "{% url 'social:create_invite' view_user.id group.id %}",
                data: {
                    'user_pk': "{{view_user.id}}",
                    'group_pk': "{{ group.id }}",
                },
                success: function (data) {
                    $('#message_area').html('')
                    if (data.message.tags === 'error') {
                        $('#message_area').append(`
                            <div class="alert alert-danger fixed-top">${data.message.text}</div>
                            `)
                    } else {
                        $('#message_area').append(`
        <div class="alert alert-${data.message.tags} fixed-top">${data.message.text}</div>
                                `)
                    }
                }
            })
            setTimeout(() => {
                $('#message_area').fadeOut()
            }, 3200);
        })

    })
</script>
{% endfor %}


{% endblock content %}